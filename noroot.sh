#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ root
if [ "$(id -u)" -ne 0 ]; then
    echo "‚û† –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å sudo: sudo $0" >&2
    exit 1
fi

# –ó–∞–ø—Ä–æ—Å –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
read -p "‚û† –í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: " username

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞—Ä–æ–ª–µ–º
echo "‚û† –°–æ–∑–¥–∞—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è $username..."
adduser --gecos "" "$username" || { echo "‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"; exit 1; }

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ sudo
echo "‚û† –û–±–Ω–æ–≤–ª—è—é –ø–∞–∫–µ—Ç—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é sudo..."
apt update && apt install -y sudo || { echo "‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ sudo"; exit 1; }

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É sudo
echo "‚û† –î–æ–±–∞–≤–ª—è—é $username –≤ –≥—Ä—É–ø–ø—É sudo..."
usermod -aG sudo "$username" || { echo "‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ sudo"; exit 1; }

### üîπSudo –° –ø–∞—Ä–æ–ª–µ–º 
echo "$username ALL=(ALL:ALL) ALL" >> /etc/sudoers

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ root-–ª–æ–≥–∏–Ω–∞ –≤ SSH
echo "‚û† –û—Ç–∫–ª—é—á–∞—é –≤—Ö–æ–¥ –ø–æ–¥ root –≤ SSH..."
sed -i 's/^#PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config
sed -i 's/^PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ SSH
echo "‚û† –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é SSH..."
systemctl restart ssh

# –ò—Ç–æ–≥
echo "
‚úÖ –ì–æ—Ç–æ–≤–æ!
-------------------------------------------
‚ñ™ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $username
‚ñ™ –ü–∞—Ä–æ–ª—å: —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∑–∞–¥–∞–ª–∏
‚ñ™ Sudo: —Ä–∞–∑—Ä–µ—à—ë–Ω (—Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–∞—Ä–æ–ª—è)
‚ñ™ Root-–ª–æ–≥–∏–Ω: –û–¢–ö–õ–Æ–ß–Å–ù

üîê –¢–µ–ø–µ—Ä—å –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å —Ç–∞–∫:
ssh $username@–≤–∞—à_—Å–µ—Ä–≤–µ—Ä_IP
"
